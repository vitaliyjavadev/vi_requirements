# project_rules

# Оглавление

1. [Правила на проекте](#project_rules)
2. [Оглавление](#оглавление)
3. [Описание профилей сборки в проекте](#описание-профилей-сборки-в-проекте)
    1. [Сборка приложения](#сборка-приложения)
    2. [Сборка приложения с выключенными анализаторами кода](#сборка-приложения-с-выключенными-анализаторами-кода)
    3. [Запуск интеграционных тестов](#запуск-интеграционных-тестов)
4. [Настройка окружения](#настройка-окружения)
    1. [Настройка окружения для разработки](#настройка-окружения-для-разработки)
        1. [Настройка checkstyle](#настройка-checkstyle)
        2. [Настройка запуска в idea](#настройка-запуска-в-idea)
5. [Локальный запуск](#локальный-запуск)
    1. [Настройки сервисов в docker-compose](#настройки-сервисов-в-docker-compose)
6. [Правила разработки](#правила-разработки)
    1. [Правила написания changeset](#правила-написания-changeset)
        1. [Название файла changeset](#название-файла-changeset)
        2. [Заголовок миграции в changeset](#заголовок-миграции-в-changeset)
    2. [Конвенция коммитов](#конвенция-коммитов)
    3. [Правила оформления Merge Request](#правила-оформления-merge-request)
    4. [Gitflow](#gitflow)

# Описание профилей сборки в проекте

## Сборка приложения

Стандартная (включая проверку кода и выключая интеграционные тесты) сборка
приложения выполняется через команды:

- mvn clean package
- mvn package

## Сборка приложения с выключенными анализаторами кода

Сборка с выключенной проверкой кода выполняется с помощью профиля
`code-analyze-off`, например:

- mvn clean package -Pcode-analyze-off
- mvn package -Pcode-analyze-off

## Запуск интеграционных тестов

Интеграционные тесты запускаются с помощью следующих команд:

- mvn clean verify -Pintegration-tests
- mvn verify -Pintegration-tests

# Настройка окружения

## Настройка окружения для разработки

### Настройка checkstyle

Настроить checkstyle кода в IDE, импортировав файл
настроек [/config/checkstyle/checkstyle.xml](/config/checkstyle/checkstyle.xml).

Для idea необходимо перейти в `tools->checkstyle` и добавить конфигурацию:

![checkstyle-idea](/docs/readme/pics/checkstyle-idea.png)

### Настройка запуска в idea

Для запуска приложения через IDEA необходимо выставить переменные окружения,
описанные в [файле](/config/idea/app-parameters.env).

Также можно добавить этот файл в переменные окружения через плагины (например,
EnvFile).

# Локальный запуск

Для запуска приложения необходимо выполнить следующие шаги:

1. Запустить [docker-compose](/docker/local/docker-compose.yml);
2. Запустить приложение с помощью IDE.

Для запуска приложения в docker необходимо выполнить следующие шаги:

1. Выполнить сборку приложения через `mvn clean package`/`mvn package`;
2.
Запустить [docker-compose c приложением](/docker/local-with-application/docker-compose.yml).

## Настройки сервисов в docker-compose

!TBD!

# Правила разработки

## Правила написания changeset

Файлы миграции (changeset) пишутся только в формате SQL.

### Название файла changeset

Файл changeset должен называться по следующему паттерну:

```
<timestamp>-<create/drop/update>-<table/view>-<table-name/view-name>.sql
```

Например:

```
1760534040-create-table-orders.sql
```

### Заголовок миграции в changeset

Заголовок в файле changeset имеет примерно следующий паттерн:

```sql
-- liquibase formatted sql
-- changeset <gitlab-login>:<timestamp>
```

Например:

```sql
-- liquibase formatted sql
-- changeset artem.volodin:1760534040
```

## Конвенция коммитов

Коммиты в ветку имеют следующие шаблоны:

```
<задача>: <краткое описание>
```

```
<задача>: <краткое описание>

<более подробное описание>
```

```
HOTFIX: <краткое описание>
```

```
HOTFIX: <краткое описание>

<более подробное описание>
```

где:

- <задача> - задача из Jira, например, UPL0810-2;
- <краткое описание> - краткое описание сделанного в рамках задачи;
- <более подробное описание> - более подробное описание, если оно требуется;
- HOTFIX - пишется для hotfix, которые выполняются без задачи.

## Правила оформления Merge Request

Пример оформления merge-request:

![merge-request](/docs/readme/pics/merge-request.png)

Поле `title` заполняется следующим шаблоном:

```
<задача>: <название задачи>
```

где:

- <задача> - задача из Jira, например, UPL0810-2;
- <название задачи> - название задачи из Jira

Если задач в рамках одного MR несколько, то выбирается какая-то одна для
названия

В поле `description` необходимо указывать задачи, которые выполнены в рамках MR
через `Closes <задача>`, если задач несколько, то описывается это так:

```
Closes <задача-1>

Closes <задача-2>

<описание>
```

Для описания необходимо указывать описание выполненной работы, достаточного для
погружения в контекст. Желательно, делать разделения на пункты, указывать как
тестировал и прикладывать тестовые данные/запросы.

В поле `assignee` указывается тот, кто выполнял задачу, если над задачей
работало несколько человек, то указываются все.

В поле `reviewer` указываются все ревьюверы (минимум 1).

## Gitflow

Основные используемые ветки:

- master - основная ветка;
- feature/<feature-задача> - ветка, в которой реализуется какой-то функционал с
  соответствующей задачей. Если задача имеет подзадачи, то создаётся сперва
  feature-ветка с основной задачей, в которую вливаются все feature-ветки с
  подзадачами, исправляются конфликты и затем сливается в основной;
- fix/<bug-задача> - веткая, в которой производится исправление багов с
  соответствующими задачами;
- hotfix/<краткое описание> - ветка, в которой производится исправление
  багов/небольших ошибок, к которым нет соответствующих задач;
- release/<версия> - ветка, в которой отводится релиз, при этом master не
  блокируется, исправление багов для версии выполняется в релизную ветку и
  делается cherry-pick с MR для master.

Процессы:

1. Тестирование QA - QA выполняет деплой на test-стенд с master/release ветки;
2. Тестирование Developer - разработчик выполняет деплой на стенд с
   feature/fix/hotfix веток на dev-стенд.